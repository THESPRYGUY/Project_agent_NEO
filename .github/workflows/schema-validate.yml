name: schema-validate

on:
  pull_request:
    types: [opened, synchronize, reopened, ready_for_review]
  workflow_dispatch: {}

jobs:
  schema:
    name: schema-validate
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      - name: Install validators
        run: |
          python -m pip install --upgrade pip
          python -m pip install pyyaml
      - name: Validate JSON files
        run: |
          python - <<'PY'
          import json, pathlib, sys
          roots = [pathlib.Path(".github")]
          errs = 0
          for root in roots:
              if not root.exists():
                  continue
              for path in root.rglob("*.json"):
                  try:
                      with open(path, "r", encoding="utf-8") as fh:
                          json.load(fh)
                  except Exception as exc:
                      print(f"[json] {path}: {exc}")
                      errs += 1
          sys.exit(errs)
          PY
      - name: Validate YAML files
        run: |
          python - <<'PY'
          import pathlib, sys, yaml
          roots = [pathlib.Path(".github")]
          errs = 0
          for root in roots:
              if not root.exists():
                  continue
              for path in root.rglob("*.yml"):
                  try:
                      with open(path, "r", encoding="utf-8") as fh:
                          yaml.safe_load(fh)
                  except Exception as exc:
                      print(f"[yaml] {path}: {exc}")
                      errs += 1
          sys.exit(errs)
          PY
